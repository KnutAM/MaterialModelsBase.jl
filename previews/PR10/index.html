<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · MaterialModelsBase.jl</title><meta name="title" content="Home · MaterialModelsBase.jl"/><meta property="og:title" content="Home · MaterialModelsBase.jl"/><meta property="twitter:title" content="Home · MaterialModelsBase.jl"/><meta name="description" content="Documentation for MaterialModelsBase.jl."/><meta property="og:description" content="Documentation for MaterialModelsBase.jl."/><meta property="twitter:description" content="Documentation for MaterialModelsBase.jl."/><meta property="og:url" content="https://KnutAM.github.io/MaterialModelsBase.jl/"/><meta property="twitter:url" content="https://KnutAM.github.io/MaterialModelsBase.jl/"/><link rel="canonical" href="https://KnutAM.github.io/MaterialModelsBase.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>MaterialModelsBase.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Using-material-models"><span>Using material models</span></a></li><li><a class="tocitem" href="#Implementing-material-models"><span>Implementing material models</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="stressiterations/">Stress states</a></li><li><a class="tocitem" href="differentiation/">Differentiation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/main/docs/src/index.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MaterialModelsBase"><a class="docs-heading-anchor" href="#MaterialModelsBase">MaterialModelsBase</a><a id="MaterialModelsBase-1"></a><a class="docs-heading-anchor-permalink" href="#MaterialModelsBase" title="Permalink"></a></h1><p><a href="https://github.com/KnutAM/MaterialModelsBase.jl">MaterialModelsBase</a> provides an implementation-agnostic interface for mechanical (stress-strain) material models. This facilitates interchanging material models between researchers by having a light-weight common interface.</p><p>Consequently, there are two types of user roles for this package (often the same person takes both roles):</p><ol><li>Someone writing code that use material models (e.g. finite element code)</li><li>Someone implementing material models</li></ol><h2 id="Using-material-models"><a class="docs-heading-anchor" href="#Using-material-models">Using material models</a><a id="Using-material-models-1"></a><a class="docs-heading-anchor-permalink" href="#Using-material-models" title="Permalink"></a></h2><p>This section describes how to use a material model defined according to the described interface. The <code>TestMaterials</code> module is used to provide some implemented material models (see <code>test/TestMaterials.jl</code> in the main repo). Hence, replace <code>TestMaterials</code> with the specific material model package(s) you wish to use. </p><p>If we would like to write a function that simulates the uniaxial response of a material model, we can write a function to do that as</p><pre><code class="language-julia hljs">using MaterialModelsBase, Tensors
function simulate_uniaxial(m::AbstractMaterial, ϵ11_history, time_history)
    state = initial_material_state(material)
    cache = allocate_material_cache(material)
    stress_state = UniaxialStress()
    t_old = 0.0
    σ11_history = similar(ϵ11_history)
    for i in eachindex(ϵ11_history, time_history)
        Δt = time_history[i] - t_old
        ϵ = SymmetricTensor{2,1}((ϵ11_history[i],))
        σ, dσdϵ, state = material_response(stress_state, m, ϵ, state, Δt, cache)
        σ11_history[i] = σ[1,1]
    end
    return σ11_history
end</code></pre><p>To use this function, we need to define the material parameters for an  implemented material model in <code>TestMaterials</code>, for example</p><pre><code class="language-julia hljs">using TestMaterials
G1=50.e3; G2=80.e3; K1=100.e3; K2=160.e3; η=50e3;
material = ViscoElastic(LinearElastic(G1,K1), LinearElastic(G2,K2), η)</code></pre><p>And then we can run the simulation</p><pre><code class="language-julia hljs">ϵ11_history  = collect(range(0, 0.01; length=100))  # Ramp to 1 %
time_history = collect(range(0, 0.2; length=100))   # Constant time step
σ11_history  = simulate_uniaxial(material, ϵ11_history, time_history)</code></pre><p>This example used the stress iterations implemented in <code>MaterialModelsBase.jl</code>, see <a href="stressiterations/#Stress-states">Stress States</a>.</p><p>If these do not converge, a <a href="#MaterialModelsBase.NoStressConvergence"><code>NoStressConvergence</code></a> exception is thrown. </p><p>The package also contains the exception <a href="#MaterialModelsBase.NoLocalConvergence"><code>NoLocalConvergence</code></a>,  which shouldbe thrown from inside implemented material routines to signal  that something didn&#39;t converge and that the caller should consider  to e.g. reduce the time step or handel the issue in some other way.</p><h2 id="Implementing-material-models"><a class="docs-heading-anchor" href="#Implementing-material-models">Implementing material models</a><a id="Implementing-material-models-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-material-models" title="Permalink"></a></h2><p>To implement a material model, at minimum, it is necessary to  define a material type containing the material parameters, e.g. <code>MyMaterial</code>, and the associated <a href="#material_response"><code>material_response(::MyMaterial, args...)</code></a> function.</p><p>For materials with state variables, the function <a href="#MaterialModelsBase.initial_material_state"><code>initial_material_state</code></a> should be defined. </p><p>If some special pre-allocated variables are required for the material, the function <a href="#MaterialModelsBase.allocate_material_cache"><code>allocate_material_cache</code></a> should be defined. </p><h3 id="Advanced-use-cases"><a class="docs-heading-anchor" href="#Advanced-use-cases">Advanced use cases</a><a id="Advanced-use-cases-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-use-cases" title="Permalink"></a></h3><p>The package also provides an interface for converting <code>AbstractMaterial</code>s  to a vector of material parameters and vice versa. However, to implement  this part of the interface is not required, if only the standard usage  is intended for your material model.</p><p>Building upon that option, it is also possible to define differentiation of the material response wrt. to the material parameters, which is useful  for parameter identification using gradient based methods. For further details,  see <a href="differentiation/#Differentation-of-a-material">Differentation of a material</a>.</p><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><h3 id="material_response"><a class="docs-heading-anchor" href="#material_response"><code>material_response</code></a><a id="material_response-1"></a><a class="docs-heading-anchor-permalink" href="#material_response" title="Permalink"></a></h3><p>The main function is the <code>material_response</code> function that  primarly dispatches on the <code>AbstractMaterial</code> input type.  Two variants can be called, where the latter allows a reduced  stress state, see <a href="stressiterations/#Stress-states">Stress States</a> for further details. </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.material_response-Tuple{AbstractMaterial, Vararg{Any, 4}}" href="#MaterialModelsBase.material_response-Tuple{AbstractMaterial, Vararg{Any, 4}}"><code>MaterialModelsBase.material_response</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">material_response(
    m::AbstractMaterial, 
    strain::Union{SecondOrderTensor,Vec}, 
    old::AbstractMaterialState, 
    Δt::Union{Number,Nothing}=nothing, 
    cache::AbstractMaterialCache=allocate_material_cache(m), 
    extras::AbstractExtraOutput=NoExtraOutput()
    )</code></pre><p>Calculate the stress/traction, stiffness and updated state variables  for the material <code>m</code>, given the strain input <code>strain</code>.</p><p><strong>Mandatory arguments</strong></p><ul><li><code>m</code>: Defines the material and its parameters</li><li>The second <code>strain</code> input can be, e.g.<ul><li><code>ϵ::SymmetricTensor{2}</code>: The total small strain tensor at the end of the increment</li><li><code>F::Tensor{2}</code>: The total deformation gradient at the end of the increment</li><li><code>u::Vec</code>: The deformation at the end of the increment (for cohesive elements)</li></ul></li><li><code>old::AbstractMaterialState</code>: The material state variables at the end of the last   converged increment. The material initial material state can be obtained by   the <a href="#MaterialModelsBase.initial_material_state"><code>initial_material_state</code></a> function.</li></ul><p><strong>Optional positional arguments</strong></p><p>When calling the function, the following arguments are optional.  When implementing a material, it is not necessary to implement these  defaults, but the method signature should allow all arguments to be  compatible with libraries relying on the interface.  Typically, this can done by using <code>args...</code>, e.g.,  <code>material_response(m::MyMat, ϵ, state, args...)</code></p><ul><li><code>Δt</code>: The time step in the current increment.  Defaults: <code>nothing</code>.</li><li><code>cache::AbstractMaterialCache</code>: Cache variables that can be used to avoid allocations during each call to the <code>material_response</code> function.  Default: <a href="#MaterialModelsBase.allocate_material_cache"><code>allocate_material_cache(m)</code></a></li><li><code>extras</code>: Updated with requested extra output.  Default: <code>NoExtraOutput</code> (Empty struct)</li></ul><p><strong>Outputs</strong></p><ol><li><code>stress</code>, is the stress measure that is energy conjugated to the <code>strain</code> (2nd) input.</li><li><code>stiffness</code>, is the derivative of the <code>stress</code> output wrt. the <code>strain</code> input. </li><li><code>new_state</code>, are the updated state variables</li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The <code>state</code> given as input should not be mutated. That is, someone calling  <code>material_response</code> multiple times with the same input variables should get  the same output each time.</p></div></div><p>Common <code>strain</code> and <code>stress</code> pairs are</p><ul><li>If the second input is the small strain tensor, <span>$\boldsymbol{\epsilon}$</span> (<code>ϵ::SymmetricTensor{2}</code>), the outputs are<ul><li><code>σ::SymmetricTensor{2}</code>: Cauchy stress tensor, <span>$\boldsymbol{\sigma}$</span></li><li><code>dσdϵ::SymmetricTensor{4}</code>: Algorithmic tangent stiffness tensor, <span>$\mathrm{d}\boldsymbol{\sigma}/\mathrm{d}\boldsymbol{\epsilon}$</span></li></ul></li><li>If the second input is the deformation gradient <span>$\boldsymbol{F}$</span> (<code>F::Tensor{2}</code>)`, the outputs are<ul><li><code>P::Tensor{2}</code>: First Piola-Kirchhoff stress, <span>$\boldsymbol{P}$</span></li><li><code>dPdF::Tensor{4}</code>: Algorithmic tangent stiffness tensor, <span>$\mathrm{d}\boldsymbol{P}/\mathrm{d}\boldsymbol{F}$</span></li></ul></li><li>If the second input is deformation vector, <span>$\boldsymbol{u}$</span> (<code>u::Vec</code>), the outputs are<ul><li><code>t::Vec</code>: Traction vector, <span>$\boldsymbol{t}$</span></li><li><code>dtdu::SecondOrderTensor</code>: Algorithmic tangent stiffness tensor, <span>$\mathrm{d}\boldsymbol{t}/\mathrm{d}\boldsymbol{u}$</span></li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/MaterialModelsBase.jl#L33-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.material_response-Tuple{AbstractStressState, AbstractMaterial, Vararg{Any}}" href="#MaterialModelsBase.material_response-Tuple{AbstractStressState, AbstractMaterial, Vararg{Any}}"><code>MaterialModelsBase.material_response</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">material_response(stress_state::AbstractStressState, m::AbstractMaterial, args...)</code></pre><p>To be able to use material models implemented for 3d stress and strain states in lower-dimensional  simulations, such as 2d plane stress, <code>MaterialModelsBase.jl</code> provides a set of stress states.  For some states, such as plane stress, iterations will be performed to find the correct state. For other states, such as plane strain, the input is only padded with zeros and the out-of-plane  components are removed from the output. </p><p>For someone implementing a material model, it is also possible to use dispatch on both the  stress state and the material to provide an efficient implementation of a reduced stress state. Note that the interface expects the full strain tensor to be given as a fourth output in this case, but it is optional to implement this but such a deviation should be documented as it could cause  problems for users of the material implementation. </p><p>The arguments are the same as for <code>material_response(::AbstractMaterial)</code>. However, both a full and reduced strain input is accepted. For a full strain input,  the out-of-plane components are used as an initial guess. For all cases,  the full strain tensor giving the desired reduced response is given as a 4th output.</p><p>See also <a href="stressiterations/#MaterialModelsBase.ReducedStressState"><code>ReducedStressState</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/stressiterations.jl#L3-L24">source</a></section></article><h3 id="State-variables"><a class="docs-heading-anchor" href="#State-variables">State variables</a><a id="State-variables-1"></a><a class="docs-heading-anchor-permalink" href="#State-variables" title="Permalink"></a></h3><p>To support state variables define</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.initial_material_state" href="#MaterialModelsBase.initial_material_state"><code>MaterialModelsBase.initial_material_state</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">initial_material_state(m::AbstractMaterial)</code></pre><p>Return the (default) initial <code>state::AbstractMaterialState</code>  of the material <code>m</code>. </p><p>Defaults to the empty <code>NoMaterialState()</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/MaterialModelsBase.jl#L109-L116">source</a></section></article><h3 id="Cache"><a class="docs-heading-anchor" href="#Cache">Cache</a><a id="Cache-1"></a><a class="docs-heading-anchor-permalink" href="#Cache" title="Permalink"></a></h3><p>It is possible to pre-allocate a cache to avoid allocations during the material model calculation, to do this define</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.allocate_material_cache" href="#MaterialModelsBase.allocate_material_cache"><code>MaterialModelsBase.allocate_material_cache</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">allocate_material_cache(m::AbstractMaterial)</code></pre><p>Return a <code>cache::AbstractMaterialCache</code> that can be used when  calling the material to reduce allocations</p><p>Defaults to the empty <code>NoMaterialCache()</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/MaterialModelsBase.jl#L125-L132">source</a></section></article><h3 id="Extra-outputs"><a class="docs-heading-anchor" href="#Extra-outputs">Extra outputs</a><a id="Extra-outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Extra-outputs" title="Permalink"></a></h3><p>In some cases, it is necessary to define additional outputs to provide slight  variations in the material calculation. In this case, a mutable input can be  given as </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.AbstractExtraOutput" href="#MaterialModelsBase.AbstractExtraOutput"><code>MaterialModelsBase.AbstractExtraOutput</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractExtraOutput()</code></pre><p>By allocating an <code>AbstractExtraOutput</code> type, this type can be mutated to extract additional information from the internal calculations  in <code>material_response</code> only in cases when this is desired.  E.g., when calculating derivatives or for multiphysics simulations. The concrete <code>NoExtraOutput&lt;:AbstractExtraOutput</code> exists for the case when no additional output should be calculated. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/MaterialModelsBase.jl#L141-L150">source</a></section></article><h3 id="Exceptions"><a class="docs-heading-anchor" href="#Exceptions">Exceptions</a><a id="Exceptions-1"></a><a class="docs-heading-anchor-permalink" href="#Exceptions" title="Permalink"></a></h3><p>Finally, the following exceptions are included</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.MaterialConvergenceError" href="#MaterialModelsBase.MaterialConvergenceError"><code>MaterialModelsBase.MaterialConvergenceError</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MaterialConvergenceError</code></pre><p>Abstract type that can be used to catch errors related to the material not converging. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/ErrorExceptions.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.NoLocalConvergence" href="#MaterialModelsBase.NoLocalConvergence"><code>MaterialModelsBase.NoLocalConvergence</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">NoLocalConvergence(msg::String)
NoLocalConvergence(args...)</code></pre><p>Throw if the material_response routine doesn&#39;t converge internally. Other arguments than a single <code>::String</code>, are converted to <code>String</code> with <code>string</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/ErrorExceptions.jl#L8-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MaterialModelsBase.NoStressConvergence" href="#MaterialModelsBase.NoStressConvergence"><code>MaterialModelsBase.NoStressConvergence</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">NoStressConvergence(msg::String)
NoStressConvergence(args...)</code></pre><p>This is thrown if the stress iterations don&#39;t converge, see <a href="stressiterations/#Stress-states">Stress states</a> Other arguments than a single <code>::String</code>, are converted to <code>String</code> with <code>string</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/fd1496739ecc48d256282da2bd4370f101a9db0f/src/ErrorExceptions.jl#L20-L26">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="stressiterations/">Stress states »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Friday 1 December 2023 23:02">Friday 1 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
