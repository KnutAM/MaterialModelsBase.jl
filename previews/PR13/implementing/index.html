<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementation · MaterialModelsBase.jl</title><meta name="title" content="Implementation · MaterialModelsBase.jl"/><meta property="og:title" content="Implementation · MaterialModelsBase.jl"/><meta property="twitter:title" content="Implementation · MaterialModelsBase.jl"/><meta name="description" content="Documentation for MaterialModelsBase.jl."/><meta property="og:description" content="Documentation for MaterialModelsBase.jl."/><meta property="twitter:description" content="Documentation for MaterialModelsBase.jl."/><meta property="og:url" content="https://KnutAM.github.io/MaterialModelsBase.jl/implementing/"/><meta property="twitter:url" content="https://KnutAM.github.io/MaterialModelsBase.jl/implementing/"/><link rel="canonical" href="https://KnutAM.github.io/MaterialModelsBase.jl/implementing/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MaterialModelsBase.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../stressiterations/">Stress states</a></li><li><a class="tocitem" href="../conversion/">Conversion</a></li><li><a class="tocitem" href="../differentiation/">Differentiation</a></li><li class="is-active"><a class="tocitem" href>Implementation</a><ul class="internal"><li><a class="tocitem" href="#Basic-implementation-and-usage"><span>Basic implementation and usage</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Implementation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implementation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KnutAM/MaterialModelsBase.jl/blob/main/docs/src/implementing.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-implement-an-AbstractMaterial"><a class="docs-heading-anchor" href="#How-to-implement-an-AbstractMaterial">How to implement an <code>AbstractMaterial</code></a><a id="How-to-implement-an-AbstractMaterial-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-implement-an-AbstractMaterial" title="Permalink"></a></h1><p>In this tutorial, we show how a subtype of <code>AbstractMaterial</code> can be implemented, specifically we demonstrate the simple case of a viscoelastic material according  to the Zener model, illustrated by the following rheological model.</p><p><img src="../zener.svg" alt="zener model rheology"/></p><p>For this model, we then have the stress,</p><p class="math-container">\[\begin{align*}
\boldsymbol{\sigma} &amp;= K\mathrm{tr}(\epsilon)\boldsymbol{I} + \boldsymbol{\sigma}^\mathrm{dev} \\
\boldsymbol{\sigma}^\mathrm{dev} &amp;= 2 G_0 \boldsymbol{\epsilon}^\mathrm{dev} + 2 G_1 \boldsymbol{\epsilon}_\mathrm{e}^\mathrm{dev} \\
\boldsymbol{\epsilon}_\mathrm{e}^\mathrm{dev} &amp;= \boldsymbol{\epsilon}^\mathrm{dev} - \boldsymbol{\epsilon}_\mathrm{v}^\mathrm{dev}
\end{align*}\]</p><p>The stress depends on the viscous strain, <span>$\boldsymbol{\epsilon}_\mathrm{v}^\mathrm{dev}$</span>, which  is goverened by the evolution law,</p><p class="math-container">\[\dot{\boldsymbol{\epsilon}}_\mathrm{v}^\mathrm{dev} = \frac{G_1}{\eta_1} \boldsymbol{\epsilon}_\mathrm{e}^\mathrm{dev}\]</p><p>We will implement this using the Backward-Euler time integration, such that we have </p><p class="math-container">\[\boldsymbol{\epsilon}_\mathrm{v}^\mathrm{dev} = \frac{{}^\mathrm{old}\boldsymbol{\epsilon}_\mathrm{v}^\mathrm{dev} + \Delta t \frac{G_1}{\eta_1} \boldsymbol{\epsilon}^\mathrm{dev}}{1 + \Delta t \frac{G_1}{\eta_1}}\]</p><p>Where we will save the viscous strain as a state variable. </p><h2 id="Basic-implementation-and-usage"><a class="docs-heading-anchor" href="#Basic-implementation-and-usage">Basic implementation and usage</a><a id="Basic-implementation-and-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-implementation-and-usage" title="Permalink"></a></h2><p>In order to define the material, we start by defining a material struct, which subtypes <code>AbstractMaterial</code>,</p><pre><code class="language-julia hljs">using MaterialModelsBase, Tensors

@kwdef struct Zener{T} &lt;: AbstractMaterial
    K::T    # Bulk modulus
    G0::T   # Long-term shear modulus
    G1::T   # Shear modulus in viscous chain
    η1::T   # Viscosity in viscous chain
end</code></pre><pre><code class="language-julia hljs">using Markdown
content = read(file, String)
Markdown.parse(&quot;&quot;&quot;
\`\`\`julia
$content
\`\`\`
&quot;&quot;&quot;)</code></pre><div class="markdown"><pre><code class="language-julia">using MaterialModelsBase, Tensors

@kwdef struct Zener&#123;T&#125; &lt;: AbstractMaterial
    K::T    # Bulk modulus
    G0::T   # Long-term shear modulus
    G1::T   # Shear modulus in viscous chain
    η1::T   # Viscosity in viscous chain
end</code></pre>
</div><p>Next, we define the state struct as well as the <code>initial_material_state</code> function,</p><pre><code class="language-julia hljs">struct ZenerState{T} &lt;: AbstractMaterialState
    ϵv::SymmetricTensor{2,3,T,6}
end
MaterialModelsBase.initial_material_state(::Zener) = ZenerState(zero(SymmetricTensor{2,3}))</code></pre><p>Before we define some helper functions and the <code>material_response</code> function,</p><pre><code class="language-julia hljs">function calculate_viscous_strain(m::Zener, ϵ, old::ZenerState, Δt)
    return (old.ϵv + (Δt * m.G1 / m.η1) * dev(ϵ)) / (1 + Δt * m.G1 / m.η1)
end

function calculate_stress(m::Zener, ϵ, old::ZenerState, Δt)
    ϵv = calculate_viscous_strain(m, ϵ, old, Δt)
    return 3 * m.K * vol(ϵ) + 2 * m.G0 * dev(ϵ) + 2 * m.G1 * (dev(ϵ) - ϵv)
end

function MaterialModelsBase.material_response(m::Zener, ϵ, old::ZenerState, Δt, cache, extras)
    dσdϵ, σ = gradient(e -&gt; calculate_stress(m, e, old, Δt), ϵ, :all)
    ϵv = calculate_viscous_strain(m, ϵ, old, Δt)
    return σ, dσdϵ, ZenerState(ϵv)
end</code></pre><p>The main reason for defining the helper functions is to facilitate differentiating the stress  wrt. the strain input, and to avoid repeating code implementations.</p><h3 id="Using-the-implementation"><a class="docs-heading-anchor" href="#Using-the-implementation">Using the implementation</a><a id="Using-the-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-implementation" title="Permalink"></a></h3><p>After having defined the basic implementation, we can use it to simulate the stress-strain response. We will simulate the case of uniaxial stress, implying that all components of the  stress, <span>$\boldsymbol{\sigma}$</span>, is zero, except the 11 component. However, in the implementation above, we only control the strain input, but all strain components, except the 11 component, are  unknown in the case of uniaxial stress. Therefore, we will use the <code>UniaxialStress</code> stress state, to simulate a ramp of <span>$\epsilon_{11}$</span>, followed by a hold time.</p><p>We start by defining a function to calculate the uniaxial material response for any material following the <code>MaterialModelsBase</code> interface, given a time and strain history vector:</p><pre><code class="language-julia hljs">function simulate_uniaxial(m::AbstractMaterial, ϵ11_history, time_history)
    state = initial_material_state(m)
    cache = allocate_material_cache(m)
    stress_state = UniaxialStress()
    σ11_history = zero(ϵ11_history)
    for i in eachindex(ϵ11_history, time_history)[2:end]
        Δt = time_history[i] - time_history[i-1]
        ϵ = SymmetricTensor{2,1}((ϵ11_history[i],))
        σ, dσdϵ, state = material_response(stress_state, m, ϵ, state, Δt, cache)
        σ11_history[i] = σ[1,1]
    end
    return σ11_history
end</code></pre><p>Next, we define the material properties and load case</p><pre><code class="language-julia hljs">zener_material = Zener(;K = 100.0, G0 = 20.0, G1 = 30.0, η1 = 10.0) # Define material
ϵmax = 0.1  # Maximum strain value
tramp = 0.1 # Ramping time [s]
thold = 0.9 # Hold time [s]
nramp = 20  # Number of steps during ramp
nhold = 40  # Number of steps during hold

# Create the time history
t_history = collect(range(0, tramp, nramp + 1)) # Uniform ramp
append!(t_history, tramp .+ thold * range(0, 1, nhold + 1)[2:end] .^ 2) # Nonuniform hold

# Create the strain history
ϵ_history = collect(range(0, ϵmax, nramp + 1))
append!(ϵ_history, range(ϵmax, ϵmax, nhold + 1)[2:end])</code></pre><p>The nonuniform time steps make sense in this case to capture the fast relaxation after the ramp, but is not required and we could instead use more uniformly spaced time steps to get the same accuracy. First, we simply plot the loading case we supply to see this,</p><pre><code class="language-julia hljs">import CairoMakie as Plt
fig1 = Plt.Figure(;size = (600, 300))
ax1 = Plt.Axis(fig1[1,1]; xlabel = &quot;time [s]&quot;, ylabel = &quot;ϵ₁₁ [%]&quot;)
Plt.scatter!(ax1, t_history, 100 * ϵ_history)
fig1</code></pre><img src="7c831129.png" alt="Example block output"/><p>We are now ready to simulate the response,</p><pre><code class="language-julia hljs">σ_history = simulate_uniaxial(zener_material, ϵ_history, t_history)</code></pre><p>and plot it,</p><pre><code class="language-julia hljs">fig2 = Plt.Figure(;size = (600, 300))
ax2 = Plt.Axis(fig2[1,1]; xlabel = &quot;time [s]&quot;, ylabel = &quot;σ₁₁ [MPa]&quot;)
Plt.lines!(ax2, t_history, σ_history)
fig2</code></pre><img src="c1da7784.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../differentiation/">« Differentiation</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Wednesday 12 March 2025 22:21">Wednesday 12 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
